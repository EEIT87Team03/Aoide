<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<style>
</style>
</head>
<body>
<!-- 	<input type = "button" id = "join" value = "Join"> -->
	<input type = "file" id = "selectFile" name = "selectFile">
	<input type = "button" id = "upload" value = "Upload">
	<span id="status"></span><span id="progress"></span>
	<img src="#" id = "previewImg"  alt = "preview image" width = "300" height = "300" style = "display : none"/>
	
	<script>
// 		document.getElementById( "join" ).onclick = 
// 				function( event )
// 				{
// 					window.open( "chatRoom.html", "_blank", 
// 							"titlebar = 0, top=500, left=1000, width=550, height=290" );
// 				};
		var xhr = null;
		document.getElementById( "selectFile" ).onchange = 
										function()
										{
											var selectedFile = this.files[0];
											var reader = new FileReader();	
											reader.onload = function( event )
													{
														document.getElementById( "previewImg" ).src = reader.result;
														//document.getElementById( "previewImg" ).src = event.target.result;
														document.getElementById( "previewImg" ).style.display = "block";
													};
											reader.readAsDataURL( selectedFile );
										};
		
		document.getElementById( "upload" ).onclick =	
			function()
			{
				var selectedFile = document.getElementById( "selectFile" ).files[0];
				document.getElementById("status").innerHTML = "Uploading " + selectedFile.name;
				
				var formData = new FormData();
                formData.append( "file", selectedFile );

				xhr = new XMLHttpRequest();
				xhr.upload.addEventListener( "progress", onProgressHandler, false );
				xhr.onload = function()
							 { 
									if ( this.status == 200 )
									{
										var img = document.createElement( "img" );
										img.src = window.URL.createObjectURL( this.response );
										img.onload = function(){ window.URL.revokeObjectURL( img.src ) }
										img.style.height = img.style.width = "300px";
										document.body.appendChild( img );
							  		}
								
							 };
				xhr.open( "POST", "UploadImage" );
				xhr.responseType = "blob";
				xhr.send( formData );
	
			};
		function onProgressHandler( event ) 
		{
        	// Note: doesn't work with async=false.
        	if ( event.lengthComputable )
            {
        		var progress = Math.round( event.loaded / event.total * 100 );
        		document.getElementById("progress").innerHTML = " Progress " + progress + "%";
            }
        }
	</script>
</body>
</html>